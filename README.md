# Yadladoc: reliable, tested code snippets in your documentation
Inspired by [cram](https://bitheap.org/cram/), [knit](https://github.com/Kotlin/kotlinx-knit), [mdoc](https://github.com/scalameta/mdoc), [mdx](https://github.com/realworldocaml/mdx) 

## Usage
### Basics
! Yadladoc requires a `.ydoc` folder at the place of execution. You can leave it empty for the default configuration

````console ydoc.example=usage/basics/run.t
Yadladoc can be run in two modes 'check' and 'run'
  $ java -jar ydoc.jar --help
  Usage: yadladoc {run|check} <markdown_file>
      run  : generate documentation code from snippets in <markdown_file>
      check: validate that the currrent documentation code is identical to what would be generated by 'run'

For both modes, the input is a markdown file containing code snippets marked with ydoc.example=<name>
  $ cat README.md
  # Test README
  
  Here is a code snippet that would generate an actual test file:
  
  ```java ydoc.example=Test.java
  import org.junit.jupiter.api.Test;
  import static org.junit.jupiter.api.Assertions.assertEquals;
  class Test {
      @Test
      void test() {
          assertEquals(42, 21 * 2);
      }
  }
  
  ```

In 'run' mode, Yadladoc generates actual files based on these code snippets
  $ java -jar ydoc.jar run README.md
  Generated Test.java from README.md
  $ cat Test.java
  import org.junit.jupiter.api.Test;
  import static org.junit.jupiter.api.Assertions.assertEquals;
  class Test {
      @Test
      void test() {
          assertEquals(42, 21 * 2);
      }
  }

In 'check' mode, Yadladoc verifies that the files content indeed match what would be generated from the snippets
  $ java -jar ydoc.jar check README.md
It will fail on files with mismatching content
  $ sed -i 's/assertEquals/assertNumberEquals/g' Test.java
  $ java -jar ydoc.jar check README.md
  Error [MismatchingContent]: File 'Test.java' has mismatching content with what would have been generated
  Expected
  vvvvvvv
  import org.junit.jupiter.api.Test;
  import static org.junit.jupiter.api.Assertions.assertNumberEquals;
  class Test {
      @Test
      void test() {
          assertNumberEquals(42, 21 * 2);
      }
  }
  
  ^^^^^^^
  
  Actual
  vvvvvvv
  import org.junit.jupiter.api.Test;
  import static org.junit.jupiter.api.Assertions.assertNumberEquals;
  class Test {
      @Test
      void test() {
          assertNumberEquals(42, 21 * 2);
      }
  }
  
  ^^^^^^^
  [2]

It will fail on missing files
  $ rm Test.java
  $ java -jar ydoc.jar check README.md
  Error [MissingFile]: File 'Test.java' is missing
  [2]
````

### Marking a snippet as an example
yadladoc will use snippets marked with the property `ydoc.example=<name>` and ignore the other. Snippets sharing the same `<name>` will be grouped in the same example file named after `<name>` and the language of the snippet.

````markdown
# Example
Here is a snippet that would generate an examples/add.py file

```python ydoc.example=examples/add
def add(a: int, b: int) -> int:
        return a + b
```

And here is one that would be ignored:
```python
def hey():
        print("Hey")
```
````

### Templates
**TODO**

## Install
### From source
Run `make usage/ydoc.jar` to produce the executable jar `ydoc.jar` in `usage/`

### From the release jar
**COMING SOON**
### From the release binary
**COMING SOON**

## Contribute
### Test suites
`YadladocSuite` groups the high level 'end to end' tests an should be a good entrypoint to have an overview of the current features. The other suites focus on more technical modules, such as Mardkwown parsing. AssertExtensions and SuiteExtensions are test-only helpers (see section [Notes on the test style])

### Reading the tests
Most tests are written with a thin wrapper around munit assertions in a 'state what you expect' style.
Statements like these:
```scala ydoc.example=yadladoc/test/src/nyub/yadladoc/examples/assertions.scala ydoc.prefix=test
        42 isEqualTo 42
```
Are equivalent to
```scala ydoc.example=yadladoc/test/src/nyub/yadladoc/examples/assertions.scala
        assertEquals(42, 42)
```

Since Yadladoc produces files, tests in YadladocSuite make heavy usage of `hasContent`:
```scala ydoc.example=yadladoc/test/src/nyub/yadladoc/examples/assertions.scala ydoc.prefix=test
        val file = Files.createTempDirectory("test").resolve("ok.txt")
        Files.writeString(file, "Line1\nLine2")
        file hasContent "Line1\nLine2" // entire content
        file hasContent List("Line1", "Line2") // line by line
```
equivalent to
```scala ydoc.example=yadladoc/test/src/nyub/yadladoc/examples/assertions.scala
        assertEquals(Files.readString(file), "Line1\nLine2")
```
